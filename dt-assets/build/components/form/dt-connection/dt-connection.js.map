{"version":3,"file":"dt-connection.js","sources":["../../../src/components/form/dt-connection/dt-connection.js"],"sourcesContent":["import { css, html } from 'lit';\nimport { DtTags } from '../dt-tags/dt-tags.js';\n\nexport class DtConnection extends DtTags {\n  static get styles() {\n    return [\n      ...super.styles,\n      css`\n        .selected-option a {\n          border-inline-start: solid 3px transparent;\n        }\n\n        li button * {\n          pointer-events: none;\n        }\n\n        li {\n          border-inline-start: solid 5px transparent;\n        }\n\n        li button .status {\n          font-style: italic;\n          opacity: 0.6;\n        }\n        li button .status:before {\n          content: '[';\n          font-style: normal;\n        }\n        li button .status:after {\n          content: ']';\n          font-style: normal;\n        }\n\n        li button svg {\n          width: 20px;\n          height: auto;\n          margin-bottom: -4px;\n        }\n        li button svg use {\n          fill: var(--dt-connection-icon-fill, var(--primary-color));\n        }\n      `,\n    ];\n  }\n\n  _clickOption(e) {\n    console.log(e);\n    if (e.target && e.target.value) {\n      const id = parseInt(e.target.value, 10);\n      const option = this.filteredOptions.reduce((result, opt) => {\n        if (!result && opt.id === id) {\n          return opt;\n        }\n        return result;\n      }, null);\n      this._select(option);\n    }\n  }\n\n  _clickAddNew(e) {\n    if (e.target) {\n      this._select({\n        id: e.target.dataset?.label,\n        label: e.target.dataset?.label,\n        isNew: true,\n      });\n      // clear search field if clicked with mouse, since field will lose focus\n      const input = this.shadowRoot.querySelector('input');\n      if (input) {\n        input.value = '';\n      }\n    }\n  }\n\n  _keyboardSelectOption() {\n    if (this.activeIndex > -1) {\n      if (this.activeIndex + 1 > this.filteredOptions.length) {\n        this._select({\n          id: this.query,\n          label: this.query,\n          isNew: true,\n        });\n      } else {\n        this._select(this.filteredOptions[this.activeIndex]);\n      }\n    }\n  }\n\n  _remove(e) {\n    if (e.target && e.target.dataset && e.target.dataset.value) {\n      const event = new CustomEvent('change', {\n        detail: {\n          field: this.name,\n          oldValue: this.value,\n        },\n      });\n      this.value = (this.value || []).map(i => {\n        const val = {\n          ...i,\n        };\n        if (i.id === e.target.dataset.value) {\n          val.delete = true;\n        }\n        return val;\n      });\n      event.detail.newValue = this.value;\n\n      // dispatch event for use with addEventListener from javascript\n      this.dispatchEvent(event);\n\n      // If option was de-selected while list was open, re-focus input\n      if (this.open) {\n        this.shadowRoot.querySelector('input').focus();\n      }\n    }\n  }\n\n  /**\n   * Filter to options that:\n   *   1: are not selected\n   *   2: match the search query\n   * @private\n   */\n  _filterOptions() {\n    const selectedValues = (this.value || [])\n      .filter(i => !i.delete)\n      .map(v => v?.id);\n\n    if (this.options?.length) {\n      this.filteredOptions = (this.options || []).filter(\n        opt =>\n          !selectedValues.includes(opt.id) &&\n          (!this.query ||\n            opt.label\n              .toLocaleLowerCase()\n              .includes(this.query.toLocaleLowerCase()))\n      );\n    } else if (this.open) {\n      // Only run this filtering if the list is open.\n      // This prevents it from running on initial load before a `load` event is attached.\n      this.loading = true;\n      this.filteredOptions = [];\n\n      // need to fetch data via API request\n      const self = this;\n      const event = new CustomEvent('load', {\n        bubbles: true,\n        detail: {\n          field: this.name,\n          postType: this.postType,\n          query: this.query,\n          onSuccess: result => {\n            self.loading = false;\n\n            // filter out selected values from list\n            self.filteredOptions = result.filter(\n              opt => !selectedValues.includes(opt.id)\n            );\n          },\n          onError: error => {\n            console.warn(error);\n            self.loading = false;\n          },\n        },\n      });\n      this.dispatchEvent(event);\n    }\n    return this.filteredOptions;\n  }\n\n  _renderSelectedOptions() {\n    return (this.value || [])\n      .filter(i => !i.delete)\n      .map(\n        opt => html`\n          <div class=\"selected-option\">\n            <a\n              href=\"${opt.link}\"\n              style=\"border-inline-start-color: ${opt.status\n                ? opt.status.color\n                : ''}\"\n              ?disabled=\"${this.disabled}\"\n              title=\"${opt.status ? opt.status.label : opt.label}\"\n              >${opt.label}</a\n            >\n            <button\n              @click=\"${this._remove}\"\n              ?disabled=\"${this.disabled}\"\n              data-value=\"${opt.id}\"\n            >\n              x\n            </button>\n          </div>\n        `\n      );\n  }\n\n  _renderOption(opt, idx) {\n    // prettier-ignore\n    const svg = html`<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><title>circle-08 2</title><desc>Created using Figma</desc><g id=\"Canvas\" transform=\"translate(1457 4940)\"><g id=\"circle-08 2\"><g id=\"Group\"><g id=\"Vector\"><use xlink:href=\"#path0_fill\" transform=\"translate(-1457 -4940)\" fill=\"#000000\"/></g></g></g></g><defs><path id=\"path0_fill\" d=\"M 12 0C 5.383 0 0 5.383 0 12C 0 18.617 5.383 24 12 24C 18.617 24 24 18.617 24 12C 24 5.383 18.617 0 12 0ZM 8 10C 8 7.791 9.844 6 12 6C 14.156 6 16 7.791 16 10L 16 11C 16 13.209 14.156 15 12 15C 9.844 15 8 13.209 8 11L 8 10ZM 12 22C 9.567 22 7.335 21.124 5.599 19.674C 6.438 18.091 8.083 17 10 17L 14 17C 15.917 17 17.562 18.091 18.401 19.674C 16.665 21.124 14.433 22 12 22Z\"/></defs></svg>`\n\n    const status = opt.status || {\n      key: '',\n      label: '',\n      color: '',\n    };\n    return html`\n      <li tabindex=\"-1\" style=\"border-inline-start-color:${status.color}\">\n        <button\n          value=\"${opt.id}\"\n          type=\"button\"\n          data-label=\"${opt.label}\"\n          @click=\"${this._clickOption}\"\n          @touchstart=\"${this._touchStart}\"\n          @touchmove=\"${this._touchMove}\"\n          @touchend=\"${this._touchEnd}\"\n          tabindex=\"-1\"\n          class=\"${this.activeIndex > -1 && this.activeIndex === idx\n            ? 'active'\n            : ''}\"\n        >\n          <span class=\"label\">${opt.label}</span>\n          <span class=\"connection-id\">(#${opt.id})</span>\n          ${status.label\n            ? html`<span class=\"status\">${status.label}</span>`\n            : null}\n          ${opt.user ? svg : null}\n        </button>\n      </li>\n    `;\n  }\n}\n\nwindow.customElements.define('dt-connection', DtConnection);\n"],"names":["window","customElements","define","DtTags","styles","super","css","_clickOption","e","console","log","target","value","id","parseInt","option","this","filteredOptions","reduce","result","opt","_select","_clickAddNew","dataset","label","isNew","input","shadowRoot","querySelector","_keyboardSelectOption","activeIndex","length","query","_remove","event","CustomEvent","detail","field","name","oldValue","map","i","val","delete","newValue","dispatchEvent","open","focus","_filterOptions","selectedValues","filter","v","options","includes","toLocaleLowerCase","loading","self","bubbles","postType","onSuccess","onError","error","warn","_renderSelectedOptions","html","link","status","color","disabled","_renderOption","idx","svg","key","_touchStart","_touchMove","_touchEnd","user"],"mappings":"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"}