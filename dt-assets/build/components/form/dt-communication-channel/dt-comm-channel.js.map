{"version":3,"file":"dt-comm-channel.js","sources":["../../../src/components/form/dt-communication-channel/dt-comm-channel.js"],"sourcesContent":["import { html, css } from 'lit';\nimport { classMap } from 'lit/directives/class-map.js';\n\nimport { DtText } from '../dt-text/dt-text.js';\n\nexport class DtCommChannel extends DtText {\n  static get styles() {\n    return [\n      ...super.styles,\n      css`\n        :host {\n          display: block;\n        }\n       .label-wrapper {\n          display: flex;\n          flex-direction: row;\n          flex-wrap: wrap;\n          width: 100%;\n          align-items: center;\n       }\n       .add-btn {\n          background-color: transparent;\n          border: none;\n       }\n        .add-icon {\n          color: var(--dt-comm-channel-add-btn-color, var(--success-color));\n          height: 1.75rem;\n          margin: 0 1rem\n        }\n        .input-group {\n          width: 100%;\n        }\n      `,\n    ];\n  }\n\n  static get properties() {\n    return {\n      ...super.properties,\n      value: { type: Array, reflect: true }\n    };\n  }\n\n  _addClick() {\n    console.log('add click');\n    console.log(this.value);\n    this.value.push({\n      verified: false,\n      value: '',\n      key: `new-${this.name}`\n    });\n    this.requestUpdate();\n  }\n\n  labelTemplate() {\n    if (!this.label) {\n      return '';\n    }\n\n    return html`\n      <dt-label\n        ?private=${this.private}\n        privateLabel=\"${this.privateLabel}\"\n        iconAltText=\"${this.iconAltText}\"\n        icon=\"${this.icon}\"\n      >\n        ${!this.icon\n          ? html`<slot name=\"icon-start\" slot=\"icon-start\"></slot>`\n          : null}\n        ${this.label}\n      </dt-label>\n      <button class=\"add-btn\" @click=${this._addClick}>\n        <svg class=\"add-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path fill=\"currentColor\" d=\"M18 10h-4V6a2 2 0 0 0-4 0l.071 4H6a2 2 0 0 0 0 4l4.071-.071L10 18a2 2 0 0 0 4 0v-4.071L18 14a2 2 0 0 0 0-4z\"></svg>\n      </button>\n    `;\n  }\n\n  _inputFieldTemplate(item) {\n    return html`\n      <div class=\"input-group\">\n        <input\n          id=\"${item.key}\"\n          name=\"${this.name}\"\n          aria-label=\"${this.label}\"\n          type=\"${this.type || 'text'}\"\n          placeholder=\"${this.placeholder}\"\n          ?disabled=${this.disabled}\n          ?required=${this.required}\n          class=\"${classMap(this.classes)}\"\n          .value=\"${item.value || ''}\"\n          @change=${this._change}\n          novalidate\n          @keyup=\"${this.implicitFormSubmit}\"\n        />\n\n        ${this.touched && this.invalid\n          ? html`<dt-exclamation-circle\n              class=\"icon-overlay alert\"\n            ></dt-exclamation-circle>`\n          : null}\n        ${this.error\n          ? html`<dt-icon\n              icon=\"mdi:alert-circle\"\n              class=\"icon-overlay alert\"\n              tooltip=\"${this.error}\"\n              size=\"2rem\"\n              ></dt-icon>`\n            : null}\n        ${this.loading\n          ? html`<dt-spinner class=\"icon-overlay\"></dt-spinner>`\n          : null}\n        ${this.saved\n          ? html`<dt-checkmark class=\"icon-overlay success\"></dt-checkmark>`\n          : null}\n      </div>\n    `;\n  }\n\n  _setFormValue(value) {\n    super._setFormValue(value);\n    this.internals.setFormValue(JSON.stringify(value));\n  }\n\n  // mapToComponent({ existingValues, idx, newValue }) {\n  //   let newValues = [...existingValues];\n  //   const prevValue = existingValues[idx];\n  //   if (prevValue?.value === newValue) return existingValues;\n  //   if (!newValue) return existingValues;\n  //   const mergedValue = { ...prevValue, value: newValue };\n  //   newValues[idx] = mergedValue;\n  //   return newValues;\n  // };\n\n  // mapToComponentRemove ({ existingValues, idx }) {\n  //   if (idx === 0 && existingValues?.length === 1) {\n  //     const newValues = [...existingValues];\n  //     newValues[idx].value = \"\";\n  //     return newValues;\n  //   }\n  //   return existingValues.filter((_, i) => i !== idx);\n  // };\n\n  _change(e) {\n    const key = e.target.id;\n    const {value} = e.target;\n    const prevValues = this.value;\n    let newValue = [...this.value];\n    const prevValue = this.value.find((o, i) => {\n      console.log(o, i);\n      if (o.key === key) {\n        return true;\n      }\n    });\n\n    console.log(prevValue);\n\n    if (key === `new-${this.name}`) {\n      newValue = [{value}]\n    } else {\n      this.value.find((o, i) => {\n        if (o.key === key) {\n            newValue = [{ verified: false, value, key }];\n            return true; // stop searching\n        }\n        return false;\n      });\n    }\n\n    console.log(newValue);\n\n    const event = new CustomEvent('change', {\n      detail: {\n        field: this.name,\n        oldValue: prevValue,\n        newValue,\n      },\n    });\n\n    const updatedIndex = this.value.findIndex((o) => {if (o.key === key) {return true}});\n\n    console.log(updatedIndex);\n\n    this.value[updatedIndex] = newValue[0];\n    console.log(this.value);\n\n    this._setFormValue(this.value);\n\n    this.dispatchEvent(event);\n  }\n\n  _renderInputFields() {\n    if (!this.value) {\n      return this._inputFieldTemplate({});\n    }\n    return html`\n      ${this.value.map((item) =>\n        this._inputFieldTemplate(item)\n      )}\n    `;\n  }\n\n  render() {\n    return html`\n     <div class=\"label-wrapper\">\n        ${this.labelTemplate()}\n      </div>\n      ${this._renderInputFields()}\n    `;\n  }\n}\n\nwindow.customElements.define('dt-comm-channel', DtCommChannel);\n"],"names":["window","customElements","define","DtText","styles","super","css","properties","value","type","Array","reflect","_addClick","console","log","this","push","verified","key","name","requestUpdate","labelTemplate","label","html","private","privateLabel","iconAltText","icon","_inputFieldTemplate","item","placeholder","disabled","required","classMap","classes","_change","implicitFormSubmit","touched","invalid","error","loading","saved","_setFormValue","internals","setFormValue","JSON","stringify","e","target","id","newValue","prevValue","find","o","i","event","CustomEvent","detail","field","oldValue","updatedIndex","findIndex","dispatchEvent","_renderInputFields","map","render"],"mappings":"qaAmNAA,OAAOC,eAAeC,OAAO,kBA9MtB,cAA4BC,EACtBC,oBACT,MAAO,IACFC,MAAMD,OACTE,CAAG,oSAyBN,CAEUC,wBACT,MAAO,IACFF,MAAME,WACTC,MAAO,CAAEC,KAAMC,MAAOC,SAAS,GAElC,CAEDC,YACEC,QAAQC,IAAI,aACZD,QAAQC,IAAIC,KAAKP,OACjBO,KAAKP,MAAMQ,KAAK,CACdC,UAAU,EACVT,MAAO,GACPU,IAAK,OAAOH,KAAKI,SAEnBJ,KAAKK,eACN,CAEDC,gBACE,OAAKN,KAAKO,MAIHC,CAAI,uBAEIR,KAAKS,0BACAT,KAAKU,8BACNV,KAAKW,sBACZX,KAAKY,SAEVZ,KAAKY,KAEJ,KADAJ,CAAI,uDAENR,KAAKO,mDAEwBP,KAAKH,2PAf/B,EAmBV,CAEDgB,oBAAoBC,GAClB,OAAON,CAAI,uCAGCM,EAAKX,cACHH,KAAKI,qBACCJ,KAAKO,gBACXP,KAAKN,MAAQ,wBACNM,KAAKe,2BACRf,KAAKgB,wBACLhB,KAAKiB,oBACRC,EAASlB,KAAKmB,qBACbL,EAAKrB,OAAS,gBACdO,KAAKoB,+BAELpB,KAAKqB,wBAGfrB,KAAKsB,SAAWtB,KAAKuB,QACnBf,CAAI,6EAGJ,QACFR,KAAKwB,MACHhB,CAAI,wEAGSR,KAAKwB,gCAGhB,QACJxB,KAAKyB,QACHjB,CAAI,iDACJ,QACFR,KAAK0B,MACHlB,CAAI,6DACJ,YAGT,CAEDmB,cAAclC,GACZH,MAAMqC,cAAclC,GACpBO,KAAK4B,UAAUC,aAAaC,KAAKC,UAAUtC,GAC5C,CAqBD2B,QAAQY,GACN,MAAM7B,EAAM6B,EAAEC,OAAOC,IACfzC,MAACA,GAASuC,EAAEC,OACCjC,KAAKP,MACxB,IAAI0C,EAAW,IAAInC,KAAKP,OACxB,MAAM2C,EAAYpC,KAAKP,MAAM4C,MAAK,CAACC,EAAGC,KAEpC,GADAzC,QAAQC,IAAIuC,EAAGC,GACXD,EAAEnC,MAAQA,EACZ,OAAO,CACR,IAGHL,QAAQC,IAAIqC,GAERjC,IAAQ,OAAOH,KAAKI,OACtB+B,EAAW,CAAC,CAAC1C,UAEbO,KAAKP,MAAM4C,MAAK,CAACC,EAAGC,IACdD,EAAEnC,MAAQA,IACVgC,EAAW,CAAC,CAAEjC,UAAU,EAAOT,QAAOU,SAC/B,KAMfL,QAAQC,IAAIoC,GAEZ,MAAMK,EAAQ,IAAIC,YAAY,SAAU,CACtCC,OAAQ,CACNC,MAAO3C,KAAKI,KACZwC,SAAUR,EACVD,cAIEU,EAAe7C,KAAKP,MAAMqD,WAAWR,IAAO,GAAIA,EAAEnC,MAAQA,EAAM,OAAO,CAAI,IAEjFL,QAAQC,IAAI8C,GAEZ7C,KAAKP,MAAMoD,GAAgBV,EAAS,GACpCrC,QAAQC,IAAIC,KAAKP,OAEjBO,KAAK2B,cAAc3B,KAAKP,OAExBO,KAAK+C,cAAcP,EACpB,CAEDQ,qBACE,OAAKhD,KAAKP,MAGHe,CAAI,GACPR,KAAKP,MAAMwD,KAAKnC,GAChBd,KAAKa,oBAAoBC,OAJpBd,KAAKa,oBAAoB,CAAA,EAOnC,CAEDqC,SACE,OAAO1C,CAAI,8BAELR,KAAKM,wBAEPN,KAAKgD,sBAEV"}