var WebComponentServices=function(t){"use strict";class e{constructor(t,e="wp-json"){this.nonce=t,this.apiRoot=e.endsWith("/")?`${e}`:`${e} + "/"`,this.apiRoot=`/${e}/`.replace(/\/\//g,"/")}async makeRequest(t,e,s,a="dt/v1/"){let n=a;n.endsWith("/")||e.startsWith("/")||(n+="/");const r=e.startsWith("http")?e:`${this.apiRoot}${n}${e}`,o={method:t,credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":this.nonce}};"GET"!==t&&(o.body=JSON.stringify(s));const i=await fetch(r,o);return await i.json()}async makeRequestOnPosts(t,e,s={}){return this.makeRequest(t,e,s,"dt-posts/v2/")}async getPost(t,e){return this.makeRequestOnPosts("GET",`${t}/${e}`)}async createPost(t,e){return this.makeRequestOnPosts("POST",t,e)}async updatePost(t,e,s){return this.makeRequestOnPosts("POST",`${t}/${e}`,s)}async deletePost(t,e){return this.makeRequestOnPosts("DELETE",`${t}/${e}`)}async getPostDuplicates(t,e,s){return this.makeRequestOnPosts("GET",`${t}/${e}/all_duplicates`,s)}async transferContact(t,e){return this.makeRequestOnPosts("POST","contacts/transfer",{contact_id:t,site_post_id:e})}async transferContactSummaryUpdate(t,e){return this.makeRequestOnPosts("POST","contacts/transfer/summary/send-update",{contact_id:t,update:e})}async requestRecordAccess(t,e,s){return this.makeRequestOnPosts("POST",`${t}/${e}/request_record_access`,{user_id:s})}async createComment(t,e,s,a="comment"){return this.makeRequestOnPosts("POST",`${t}/${e}/comments`,{comment:s,comment_type:a})}async updateComment(t,e,s,a,n="comment"){return this.makeRequestOnPosts("POST",`${t}/${e}/comments/${s}`,{comment:a,comment_type:n})}async deleteComment(t,e,s){return this.makeRequestOnPosts("DELETE",`${t}/${e}/comments/${s}`)}async getComments(t,e){return this.makeRequestOnPosts("GET",`${t}/${e}/comments`)}async toggle_comment_reaction(t,e,s,a,n){return this.makeRequestOnPosts("POST",`${t}/${e}/comments/${s}/react`,{user_id:a,reaction:n})}async getPostActivity(t,e){return this.makeRequestOnPosts("GET",`${t}/${e}/activity`)}async getSingleActivity(t,e,s){return this.makeRequestOnPosts("GET",`${t}/${e}/activity/${s}`)}async revertActivity(t,e,s){return this.makeRequestOnPosts("GET",`${t}/${e}/revert/${s}`)}async getPostShares(t,e){return this.makeRequestOnPosts("GET",`${t}/${e}/shares`)}async addPostShare(t,e,s){return this.makeRequestOnPosts("POST",`${t}/${e}/shares`,{user_id:s})}async removePostShare(t,e,s){return this.makeRequestOnPosts("DELETE",`${t}/${e}/shares`,{user_id:s})}async getFilters(){return this.makeRequest("GET","users/get_filters")}async saveFilters(t,e){return this.makeRequest("POST","users/save_filters",{filter:e,postType:t})}async deleteFilter(t,e){return this.makeRequest("DELETE","users/save_filters",{id:e,postType:t})}async searchUsers(t){return this.makeRequest("GET",`users/get_users?s=${t}`)}async createUser(t){return this.makeRequest("POST","users/create",t)}async advanced_search(t,e,s,a){return this.makeRequest("GET","advanced_search",{query:t,postType:e,offset:s,post:a.post,comment:a.comment,meta:a.meta,status:a.status},"dt-posts/v2/posts/search/")}}class s{constructor(t,s,a,n="wp-json"){this.postType=t,this.postId=s,this.nonce=a,this.apiRoot=`${n}/`.replace("//","/"),this.api=new e(this.nonce,this.apiRoot),this.autoSaveComponents=["dt-connection","dt-date","dt-location","dt-multi-select","dt-number","dt-single-select","dt-tags","dt-text","dt-textarea","dt-toggle"]}enableAutoSave(t){const e=document.querySelectorAll(t||this.autoSaveComponents.join(","));e&&e.forEach((t=>t.addEventListener("change",this.handleChangeEvent.bind(this))))}async handleChangeEvent(t){const e=t.detail;if(e){const{field:a,newValue:n}=e,r=t.target.tagName.toLowerCase(),o=s.convertValue(r,n);t.target.setAttribute("loading",!0);try{await this.api.updatePost(this.postType,this.postId,{[a]:o}),t.target.removeAttribute("loading"),t.target.setAttribute("saved",!0)}catch(e){t.target.removeAttribute("loading"),t.target.setAttribute("invalid",!0)}}}static convertValue(t,e){let s=e;if(e)switch(t){case"dt-toggle":"string"==typeof e&&(s="true"===e.toLowerCase());break;case"dt-multi-select":"string"==typeof e&&(s=[e]),s={values:s.map((t=>{const e={value:t.replace("-","")};return t.startsWith("-")&&(e.delete=!0),e})),force_values:!1};break;case"dt-connection":case"dt-location":case"dt-tags":"string"==typeof e&&(s=[{id:e}]),s={values:s.map((t=>{const e={value:t.id};return t.delete&&(e.delete=t.delete),e})),force_values:!1}}return s}}return t.ApiService=e,t.ComponentService=s,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
